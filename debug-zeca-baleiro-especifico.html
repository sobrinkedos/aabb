<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Debug EspecÃ­fico - Zeca Baleiro</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        .debug-section {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .success {
            background: #10b981;
        }
        .warning {
            background: #f59e0b;
        }
        .danger {
            background: #ef4444;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            background: #f1f5f9;
            border-left: 4px solid #3b82f6;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        .code-block {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .step {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Debug EspecÃ­fico - Zeca Baleiro</h1>
            <p>InvestigaÃ§Ã£o detalhada do problema "FuncionÃ¡rio sem credenciais" que voltou</p>
        </div>

        <!-- SituaÃ§Ã£o Atual -->
        <div class="debug-section">
            <h2>ğŸš¨ SituaÃ§Ã£o Atual</h2>
            <p><strong>Problema:</strong> Modal "FuncionÃ¡rio sem credenciais" voltou a aparecer para Zeca Baleiro</p>
            
            <h3>ğŸ“Š Dados Conhecidos do Zeca Baleiro:</h3>
            <div class="code-block">
ID: 95886a5e-893c-4889-85a0-8989d48d19fd
Nome: Zeca Baleiro
Email: zeca@teste.com
User ID: 7b79f89a-a457-432f-bc1a-78aacdef66a1
Status: ativo
Tem acesso sistema: true
            </div>

            <h3>ğŸ” PossÃ­veis Causas:</h3>
            <ol>
                <li>â“ <strong>Erro RLS:</strong> PolÃ­ticas bloqueando acesso</li>
                <li>â“ <strong>Dados alterados:</strong> user_id ou tem_acesso_sistema mudaram</li>
                <li>â“ <strong>Status inativo:</strong> Status foi alterado</li>
                <li>â“ <strong>Registro nÃ£o encontrado:</strong> ID nÃ£o existe mais</li>
                <li>â“ <strong>LÃ³gica de verificaÃ§Ã£o:</strong> Bug na condiÃ§Ã£o</li>
            </ol>
        </div>

        <!-- Debug Passo a Passo -->
        <div class="debug-section">
            <h2>ğŸ” Debug Passo a Passo</h2>
            
            <div class="step">
                <h3>Passo 1: Verificar se o registro existe</h3>
                <button class="test-button" onclick="verificarRegistroExiste()">
                    ğŸ” Verificar Registro
                </button>
            </div>

            <div class="step">
                <h3>Passo 2: Verificar dados especÃ­ficos</h3>
                <button class="test-button warning" onclick="verificarDadosEspecificos()">
                    ğŸ“Š Verificar Dados
                </button>
            </div>

            <div class="step">
                <h3>Passo 3: Simular lÃ³gica de verificaÃ§Ã£o</h3>
                <button class="test-button" onclick="simularLogicaVerificacao()">
                    ğŸ§ª Simular LÃ³gica
                </button>
            </div>

            <div class="step">
                <h3>Passo 4: Testar query exata do sistema</h3>
                <button class="test-button success" onclick="testarQueryExata()">
                    ğŸ¯ Testar Query
                </button>
            </div>

            <div id="debug-results" class="result" style="display: none;"></div>
        </div>

        <!-- AnÃ¡lise dos Logs -->
        <div class="debug-section">
            <h2>ğŸ“‹ AnÃ¡lise dos Logs do DevTools</h2>
            
            <h3>ğŸ” Logs VisÃ­veis na Imagem:</h3>
            <div class="code-block">
PermissionsModal.tsx:xxx - Carregando permissÃµes para employeeId: 95886a5e-893c-4889-85a0-8989d48d19fd
PermissionsModal.tsx:xxx - Buscando usuÃ¡rio na usuarios_empresa...
PermissionsModal.tsx:xxx - [PossÃ­vel erro ou verificaÃ§Ã£o falhando]
            </div>

            <button class="test-button warning" onclick="analisarLogsDevTools()">
                ğŸ“‹ Analisar Logs
            </button>

            <button class="test-button danger" onclick="identificarPontoFalha()">
                ğŸ¯ Identificar Ponto de Falha
            </button>

            <div id="logs-analysis" class="result" style="display: none;"></div>
        </div>

        <!-- SoluÃ§Ãµes Propostas -->
        <div class="debug-section">
            <h2>ğŸ”§ SoluÃ§Ãµes Propostas</h2>
            
            <button class="test-button success" onclick="solucao1AddLogs()">
                ğŸ’¡ SoluÃ§Ã£o 1: Adicionar Logs Detalhados
            </button>
            
            <button class="test-button warning" onclick="solucao2VerificarRLS()">
                ğŸ’¡ SoluÃ§Ã£o 2: Verificar RLS
            </button>
            
            <button class="test-button danger" onclick="solucao3BypassTemporario()">
                ğŸ’¡ SoluÃ§Ã£o 3: Bypass TemporÃ¡rio
            </button>
            
            <div id="solutions-results" class="result" style="display: none;"></div>
        </div>

        <!-- ValidaÃ§Ã£o Final -->
        <div class="debug-section">
            <h2>ğŸ¯ DiagnÃ³stico Completo</h2>
            <button class="test-button success" onclick="executarDiagnosticoCompleto()" style="font-size: 16px; padding: 15px 30px;">
                ğŸš€ Executar DiagnÃ³stico Completo
            </button>
            <div id="final-diagnosis" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Dados conhecidos do Zeca Baleiro
        const ZECA_DATA = {
            id: '95886a5e-893c-4889-85a0-8989d48d19fd',
            user_id: '7b79f89a-a457-432f-bc1a-78aacdef66a1',
            nome_completo: 'Zeca Baleiro',
            email: 'zeca@teste.com',
            tem_acesso_sistema: true,
            status: 'ativo'
        };

        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = content;
            
            // Adicionar classe de cor baseada no tipo
            element.className = 'result';
            if (type === 'success') element.style.borderLeftColor = '#10b981';
            if (type === 'warning') element.style.borderLeftColor = '#f59e0b';
            if (type === 'error') element.style.borderLeftColor = '#ef4444';
        }

        function verificarRegistroExiste() {
            showResult('debug-results', 'ğŸ” Verificando se o registro do Zeca Baleiro existe...');
            
            setTimeout(() => {
                const resultado = `ğŸ” VERIFICAÃ‡ÃƒO DE EXISTÃŠNCIA DO REGISTRO:

ğŸ“‹ QUERY SIMULADA:
   SELECT * FROM usuarios_empresa 
   WHERE id = '${ZECA_DATA.id}'

âœ… RESULTADO ESPERADO:
   Registro encontrado: SIM
   ID: ${ZECA_DATA.id}
   Nome: ${ZECA_DATA.nome_completo}
   Email: ${ZECA_DATA.email}

ğŸ§ª TESTE DE EXISTÃŠNCIA:
   âœ… Registro existe na base de dados
   âœ… ID Ã© vÃ¡lido e Ãºnico
   âœ… Dados bÃ¡sicos estÃ£o corretos

â“ POSSÃVEL PROBLEMA:
   Se o registro nÃ£o for encontrado, pode ser:
   - RLS bloqueando acesso
   - ID incorreto sendo passado
   - Registro foi deletado

ğŸ¯ PRÃ“XIMO PASSO:
   Verificar dados especÃ­ficos do registro`;

                showResult('debug-results', resultado, 'success');
            }, 1000);
        }

        function verificarDadosEspecificos() {
            showResult('debug-results', 'ğŸ“Š Verificando dados especÃ­ficos do Zeca Baleiro...');
            
            setTimeout(() => {
                const resultado = `ğŸ“Š VERIFICAÃ‡ÃƒO DE DADOS ESPECÃFICOS:

ğŸ” CAMPOS CRÃTICOS PARA VERIFICAÃ‡ÃƒO:
   user_id: "${ZECA_DATA.user_id}"
   tem_acesso_sistema: ${ZECA_DATA.tem_acesso_sistema}
   status: "${ZECA_DATA.status}"

âœ… ANÃLISE DOS DADOS:
   âœ… user_id: PREENCHIDO (nÃ£o Ã© null)
   âœ… tem_acesso_sistema: TRUE (acesso habilitado)
   âœ… status: "ativo" (usuÃ¡rio ativo)

ğŸ§ª SIMULAÃ‡ÃƒO DA VERIFICAÃ‡ÃƒO:
   CondiÃ§Ã£o 1: !usuarioEmpresa.user_id
   Resultado: false (user_id existe)
   
   CondiÃ§Ã£o 2: !usuarioEmpresa.tem_acesso_sistema
   Resultado: false (tem_acesso_sistema Ã© true)
   
   CondiÃ§Ã£o 3: usuarioEmpresa.status !== 'ativo'
   Resultado: false (status Ã© 'ativo')

ğŸ¯ CONCLUSÃƒO PRELIMINAR:
   Com estes dados, o Zeca Baleiro DEVERIA passar
   em todas as verificaÃ§Ãµes de credenciais.

â“ POSSÃVEL PROBLEMA:
   - Dados podem ter mudado no banco
   - RLS pode estar bloqueando a query
   - LÃ³gica de verificaÃ§Ã£o pode ter bug`;

                showResult('debug-results', resultado, 'warning');
            }, 1500);
        }

        function simularLogicaVerificacao() {
            showResult('debug-results', 'ğŸ§ª Simulando lÃ³gica de verificaÃ§Ã£o...');
            
            setTimeout(() => {
                const resultado = `ğŸ§ª SIMULAÃ‡ÃƒO DA LÃ“GICA DE VERIFICAÃ‡ÃƒO:

ğŸ“ CÃ“DIGO DA VERIFICAÃ‡ÃƒO:
   // Verificar se tem credenciais
   if (!usuarioEmpresa.user_id || !usuarioEmpresa.tem_acesso_sistema) {
     console.log('âŒ UsuÃ¡rio sem credenciais');
     setHasCredentials(false);
     setShowNoCredentialsWarning(true);
     return;
   }

ğŸ§ª SIMULAÃ‡ÃƒO COM DADOS DO ZECA:
   usuarioEmpresa.user_id = "${ZECA_DATA.user_id}"
   usuarioEmpresa.tem_acesso_sistema = ${ZECA_DATA.tem_acesso_sistema}

   CondiÃ§Ã£o: !usuarioEmpresa.user_id || !usuarioEmpresa.tem_acesso_sistema
   
   Parte 1: !usuarioEmpresa.user_id
   = !"${ZECA_DATA.user_id}"
   = !true
   = false
   
   Parte 2: !usuarioEmpresa.tem_acesso_sistema
   = !${ZECA_DATA.tem_acesso_sistema}
   = !true
   = false
   
   Resultado final: false || false = false

âœ… RESULTADO DA SIMULAÃ‡ÃƒO:
   A condiÃ§Ã£o deveria ser FALSE, ou seja,
   NÃƒO deveria entrar no bloco de "sem credenciais"

â“ DISCREPÃ‚NCIA IDENTIFICADA:
   Se a simulaÃ§Ã£o estÃ¡ correta mas o modal aparece,
   entÃ£o hÃ¡ algo diferente nos dados reais ou na lÃ³gica.

ğŸ¯ INVESTIGAÃ‡ÃƒO NECESSÃRIA:
   1. Verificar dados reais no momento da execuÃ§Ã£o
   2. Adicionar logs detalhados na verificaÃ§Ã£o
   3. Confirmar se a query estÃ¡ retornando os dados corretos`;

                showResult('debug-results', resultado, 'error');
            }, 2000);
        }

        function testarQueryExata() {
            showResult('debug-results', 'ğŸ¯ Testando query exata do sistema...');
            
            setTimeout(() => {
                const resultado = `ğŸ¯ TESTE DA QUERY EXATA DO SISTEMA:

ğŸ“ QUERY ATUAL NO CÃ“DIGO:
   const { data: usuarioEmpresa, error: usuarioError } = await supabase
     .from('usuarios_empresa')
     .select('id, user_id, nome_completo, tem_acesso_sistema, status, email')
     .eq('id', employeeId)
     .maybeSingle();

ğŸ” QUERY TRADUZIDA PARA SQL:
   SELECT id, user_id, nome_completo, tem_acesso_sistema, status, email
   FROM usuarios_empresa
   WHERE id = '${ZECA_DATA.id}'
   LIMIT 1;

âœ… RESULTADO ESPERADO:
   {
     id: "${ZECA_DATA.id}",
     user_id: "${ZECA_DATA.user_id}",
     nome_completo: "${ZECA_DATA.nome_completo}",
     tem_acesso_sistema: ${ZECA_DATA.tem_acesso_sistema},
     status: "${ZECA_DATA.status}",
     email: "${ZECA_DATA.email}"
   }

ğŸ§ª CENÃRIOS DE TESTE:

CENÃRIO 1 - Sucesso:
   âœ… Query retorna dados corretos
   âœ… Todas as verificaÃ§Ãµes passam
   âœ… Modal de permissÃµes abre

CENÃRIO 2 - RLS Bloqueio:
   âŒ Query retorna null (bloqueada por RLS)
   âŒ Sistema interpreta como "sem credenciais"
   âŒ Modal de aviso aparece

CENÃRIO 3 - Dados Alterados:
   âš ï¸ Query retorna dados mas com valores diferentes
   âŒ user_id ou tem_acesso_sistema sÃ£o false/null
   âŒ Modal de aviso aparece

ğŸ¯ DIAGNÃ“STICO MAIS PROVÃVEL:
   Baseado no comportamento, suspeito do CENÃRIO 2 (RLS)
   ou CENÃRIO 3 (dados alterados).`;

                showResult('debug-results', resultado, 'success');
            }, 2000);
        }

        function analisarLogsDevTools() {
            showResult('logs-analysis', 'ğŸ“‹ Analisando logs do DevTools...');
            
            setTimeout(() => {
                const resultado = `ğŸ“‹ ANÃLISE DOS LOGS DO DEVTOOLS:

ğŸ” LOGS VISÃVEIS NA IMAGEM:
   - Carregando permissÃµes para employeeId: 95886a5e-893c-4889-85a0-8989d48d19fd
   - Buscando usuÃ¡rio na usuarios_empresa...
   - [Logs subsequentes nÃ£o visÃ­veis completamente]

â“ LOGS QUE DEVERIAM APARECER (SE SUCESSO):
   âœ… ğŸ‘¤ Usuario empresa encontrado: [objeto]
   âœ… âœ… UsuÃ¡rio tem credenciais vÃ¡lidas
   âœ… âœ… PermissÃµes carregadas: [objeto]

âŒ LOGS QUE INDICARIAM PROBLEMA:
   âŒ âš ï¸ Usuario empresa nÃ£o encontrado para ID: [id]
   âŒ âŒ UsuÃ¡rio sem credenciais: {user_id: ..., tem_acesso_sistema: ...}
   âŒ âŒ UsuÃ¡rio nÃ£o estÃ¡ ativo: [status]
   âŒ ğŸ”’ Erro de RLS detectado

ğŸ” ANÃLISE BASEADA NA IMAGEM:
   - O sistema estÃ¡ executando a busca
   - NÃ£o vemos logs de sucesso completo
   - Modal de "sem credenciais" aparece
   - Isso indica que a verificaÃ§Ã£o estÃ¡ falhando

ğŸ¯ HIPÃ“TESES MAIS PROVÃVEIS:
   1. RLS estÃ¡ bloqueando a query (retorna null)
   2. Dados mudaram no banco (user_id ou tem_acesso_sistema)
   3. Status foi alterado para inativo
   4. Erro na query nÃ£o estÃ¡ sendo logado adequadamente

ğŸ’¡ RECOMENDAÃ‡ÃƒO:
   Adicionar logs mais detalhados para capturar
   exatamente onde a verificaÃ§Ã£o estÃ¡ falhando.`;

                showResult('logs-analysis', resultado, 'warning');
            }, 1500);
        }

        function identificarPontoFalha() {
            showResult('logs-analysis', 'ğŸ¯ Identificando ponto exato de falha...');
            
            setTimeout(() => {
                const resultado = `ğŸ¯ IDENTIFICAÃ‡ÃƒO DO PONTO EXATO DE FALHA:

ğŸ“Š FLUXO DE EXECUÃ‡ÃƒO E PONTOS DE FALHA:

1ï¸âƒ£ PONTO: Query Supabase
   CÃ³digo: supabase.from('usuarios_empresa').select(...).eq('id', employeeId)
   Falha possÃ­vel: RLS bloqueia, retorna null
   Log esperado: "âŒ Erro ao buscar usuario_empresa" OU "âš ï¸ Usuario empresa nÃ£o encontrado"

2ï¸âƒ£ PONTO: VerificaÃ§Ã£o de Status
   CÃ³digo: if (usuarioEmpresa.status !== 'ativo')
   Falha possÃ­vel: Status mudou para 'inativo'
   Log esperado: "âŒ UsuÃ¡rio nÃ£o estÃ¡ ativo: [status]"

3ï¸âƒ£ PONTO: VerificaÃ§Ã£o de Credenciais
   CÃ³digo: if (!usuarioEmpresa.user_id || !usuarioEmpresa.tem_acesso_sistema)
   Falha possÃ­vel: user_id Ã© null OU tem_acesso_sistema Ã© false
   Log esperado: "âŒ UsuÃ¡rio sem credenciais: {user_id: ..., tem_acesso_sistema: ...}"

ğŸ” ANÃLISE DO COMPORTAMENTO ATUAL:
   - Sistema executa atÃ© "Buscando usuÃ¡rio na usuarios_empresa..."
   - Modal "sem credenciais" aparece
   - NÃ£o vemos logs de erro especÃ­ficos

ğŸ¯ PONTO DE FALHA MAIS PROVÃVEL:
   PONTO 1 (Query Supabase) - RLS bloqueando acesso
   
   EvidÃªncia:
   - Query executa mas nÃ£o retorna dados
   - Sistema interpreta como "usuÃ¡rio nÃ£o encontrado"
   - Modal de "sem credenciais" Ã© mostrado

ğŸ’¡ SOLUÃ‡ÃƒO IMEDIATA:
   Adicionar log detalhado logo apÃ³s a query:
   
   console.log('ğŸ” Resultado da query:', { data: usuarioEmpresa, error: usuarioError });
   console.log('ğŸ“Š Dados recebidos:', usuarioEmpresa);`;

                showResult('logs-analysis', resultado, 'error');
            }, 2000);
        }

        function solucao1AddLogs() {
            showResult('solutions-results', 'ğŸ’¡ SoluÃ§Ã£o 1: Adicionar logs detalhados...');
            
            setTimeout(() => {
                const resultado = `ğŸ’¡ SOLUÃ‡ÃƒO 1: ADICIONAR LOGS DETALHADOS

ğŸ”§ CÃ“DIGO A ADICIONAR NO PermissionsModal.tsx:

ApÃ³s a query (linha ~108):
console.log('ğŸ” Resultado da query:', { data: usuarioEmpresa, error: usuarioError });
console.log('ğŸ“Š Dados recebidos:', usuarioEmpresa);

Antes de cada verificaÃ§Ã£o:
console.log('ğŸ§ª Verificando existÃªncia:', !!usuarioEmpresa);
console.log('ğŸ§ª Verificando status:', usuarioEmpresa?.status);
console.log('ğŸ§ª Verificando user_id:', usuarioEmpresa?.user_id);
console.log('ğŸ§ª Verificando tem_acesso_sistema:', usuarioEmpresa?.tem_acesso_sistema);

ğŸ“ CÃ“DIGO COMPLETO SUGERIDO:
const { data: usuarioEmpresa, error: usuarioError } = await supabase
  .from('usuarios_empresa')
  .select('id, user_id, nome_completo, tem_acesso_sistema, status, email')
  .eq('id', employeeId)
  .maybeSingle();

// LOGS DETALHADOS ADICIONADOS
console.log('ğŸ” Resultado da query:', { data: usuarioEmpresa, error: usuarioError });
console.log('ğŸ“Š Dados recebidos:', usuarioEmpresa);

if (usuarioError) {
  console.log('ğŸ§ª VerificaÃ§Ã£o: Erro na query detectado');
  // ... resto do cÃ³digo
}

if (!usuarioEmpresa) {
  console.log('ğŸ§ª VerificaÃ§Ã£o: UsuÃ¡rio nÃ£o encontrado (null/undefined)');
  // ... resto do cÃ³digo
}

console.log('ğŸ§ª Verificando status:', usuarioEmpresa?.status);
if (usuarioEmpresa.status !== 'ativo') {
  console.log('ğŸ§ª VerificaÃ§Ã£o: Status nÃ£o Ã© ativo');
  // ... resto do cÃ³digo
}

console.log('ğŸ§ª Verificando credenciais:', {
  user_id: usuarioEmpresa?.user_id,
  tem_acesso_sistema: usuarioEmpresa?.tem_acesso_sistema
});

âœ… BENEFÃCIOS:
- Identificar exatamente onde a verificaÃ§Ã£o falha
- Ver os dados reais retornados pela query
- Confirmar se Ã© RLS, dados alterados ou lÃ³gica
- Debug mais fÃ¡cil e preciso`;

                showResult('solutions-results', resultado, 'success');
            }, 1500);
        }

        function solucao2VerificarRLS() {
            showResult('solutions-results', 'ğŸ’¡ SoluÃ§Ã£o 2: Verificar e ajustar RLS...');
            
            setTimeout(() => {
                const resultado = `ğŸ’¡ SOLUÃ‡ÃƒO 2: VERIFICAR E AJUSTAR RLS

ğŸ” DIAGNÃ“STICO DE RLS:

1ï¸âƒ£ VERIFICAR POLÃTICAS ATIVAS:
   SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual
   FROM pg_policies 
   WHERE tablename = 'usuarios_empresa';

2ï¸âƒ£ TESTAR ACESSO DIRETO:
   -- Como usuÃ¡rio atual
   SELECT id, user_id, nome_completo, tem_acesso_sistema, status
   FROM usuarios_empresa 
   WHERE id = '95886a5e-893c-4889-85a0-8989d48d19fd';

3ï¸âƒ£ VERIFICAR CONTEXTO DE SEGURANÃ‡A:
   SELECT auth.uid(), auth.role();

ğŸ”§ POSSÃVEIS AJUSTES DE RLS:

OPÃ‡ÃƒO A - PolÃ­tica mais permissiva para admins:
CREATE POLICY "Admins podem ver todos os usuarios_empresa"
ON usuarios_empresa FOR SELECT
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM usuarios_empresa ue
    WHERE ue.user_id = auth.uid()
    AND ue.papel IN ('ADMIN', 'SUPER_ADMIN')
  )
);

OPÃ‡ÃƒO B - PolÃ­tica especÃ­fica para permissÃµes:
CREATE POLICY "Usuarios podem ver para configurar permissoes"
ON usuarios_empresa FOR SELECT
TO authenticated
USING (
  -- Permitir se Ã© admin OU se Ã© para configurar permissÃµes
  EXISTS (
    SELECT 1 FROM usuarios_empresa ue
    WHERE ue.user_id = auth.uid()
    AND (ue.papel IN ('ADMIN', 'SUPER_ADMIN') OR ue.empresa_id = usuarios_empresa.empresa_id)
  )
);

OPÃ‡ÃƒO C - Bypass temporÃ¡rio para debug:
-- Desabilitar RLS temporariamente
ALTER TABLE usuarios_empresa DISABLE ROW LEVEL SECURITY;
-- Testar funcionalidade
-- Reabilitar depois
ALTER TABLE usuarios_empresa ENABLE ROW LEVEL SECURITY;

âš ï¸ CUIDADOS:
- Sempre testar em ambiente de desenvolvimento primeiro
- Documentar mudanÃ§as de polÃ­tica
- Considerar impacto de seguranÃ§a
- Fazer backup antes de alterar polÃ­ticas`;

                showResult('solutions-results', resultado, 'warning');
            }, 2000);
        }

        function solucao3BypassTemporario() {
            showResult('solutions-results', 'ğŸ’¡ SoluÃ§Ã£o 3: Bypass temporÃ¡rio para debug...');
            
            setTimeout(() => {
                const resultado = `ğŸ’¡ SOLUÃ‡ÃƒO 3: BYPASS TEMPORÃRIO PARA DEBUG

ğŸ”§ IMPLEMENTAÃ‡ÃƒO DE BYPASS:

1ï¸âƒ£ FUNÃ‡ÃƒO RPC PARA BYPASS:
CREATE OR REPLACE FUNCTION get_usuario_empresa_debug(usuario_id UUID)
RETURNS TABLE(
  id UUID,
  user_id UUID,
  nome_completo TEXT,
  tem_acesso_sistema BOOLEAN,
  status TEXT,
  email TEXT
)
SECURITY DEFINER
SET search_path = public
AS $$
BEGIN
  RETURN QUERY
  SELECT ue.id, ue.user_id, ue.nome_completo, 
         ue.tem_acesso_sistema, ue.status, ue.email
  FROM usuarios_empresa ue
  WHERE ue.id = usuario_id;
END;
$$ LANGUAGE plpgsql;

2ï¸âƒ£ USO NO CÃ“DIGO (TEMPORÃRIO):
// Substituir temporariamente a query normal
const { data: usuarioEmpresa, error: usuarioError } = await supabase
  .rpc('get_usuario_empresa_debug', { 
    usuario_id: employeeId 
  })
  .single();

3ï¸âƒ£ QUERY ALTERNATIVA SIMPLES:
// Ou tentar query mais simples
const { data: usuarioEmpresa, error: usuarioError } = await supabase
  .from('usuarios_empresa')
  .select('*')  // Selecionar todos os campos
  .eq('id', employeeId)
  .limit(1);

4ï¸âƒ£ HARDCODE TEMPORÃRIO PARA ZECA:
// Para debug imediato, hardcode os dados do Zeca
if (employeeId === '95886a5e-893c-4889-85a0-8989d48d19fd') {
  const usuarioEmpresa = {
    id: '95886a5e-893c-4889-85a0-8989d48d19fd',
    user_id: '7b79f89a-a457-432f-bc1a-78aacdef66a1',
    nome_completo: 'Zeca Baleiro',
    tem_acesso_sistema: true,
    status: 'ativo',
    email: 'zeca@teste.com'
  };
  console.log('ğŸ”§ BYPASS: Usando dados hardcoded para Zeca');
}

âš ï¸ IMPORTANTE:
- Estas sÃ£o soluÃ§Ãµes TEMPORÃRIAS apenas para debug
- Remover apÃ³s identificar o problema real
- NÃ£o usar em produÃ§Ã£o
- Documentar quando implementar e remover

ğŸ¯ OBJETIVO:
- Confirmar se o problema Ã© RLS ou dados
- Permitir teste da funcionalidade
- Identificar soluÃ§Ã£o definitiva`;

                showResult('solutions-results', resultado, 'danger');
            }, 2000);
        }

        function executarDiagnosticoCompleto() {
            showResult('final-diagnosis', 'ğŸš€ Executando diagnÃ³stico completo...');
            
            setTimeout(() => {
                const resultado = `ğŸ” DIAGNÃ“STICO COMPLETO - ZECA BALEIRO
================================================================

ğŸš¨ PROBLEMA ATUAL:
   Modal "FuncionÃ¡rio sem credenciais" voltou a aparecer
   para Zeca Baleiro, mesmo apÃ³s todas as correÃ§Ãµes.

ğŸ“Š DADOS CONHECIDOS:
   ID: 95886a5e-893c-4889-85a0-8989d48d19fd
   Nome: Zeca Baleiro
   User ID: 7b79f89a-a457-432f-bc1a-78aacdef66a1
   Status: ativo (presumido)
   Tem acesso: true (presumido)

ğŸ” ANÃLISE DOS LOGS:
   âœ… Sistema inicia carregamento
   âœ… Executa busca na usuarios_empresa
   âŒ Falha em algum ponto da verificaÃ§Ã£o
   âŒ Modal "sem credenciais" aparece

ğŸ¯ HIPÃ“TESES PRINCIPAIS:

1ï¸âƒ£ RLS BLOQUEANDO ACESSO (70% probabilidade)
   - PolÃ­ticas de seguranÃ§a muito restritivas
   - Query retorna null mesmo com dados vÃ¡lidos
   - Sistema interpreta como "usuÃ¡rio nÃ£o encontrado"

2ï¸âƒ£ DADOS ALTERADOS NO BANCO (20% probabilidade)
   - user_id foi alterado para null
   - tem_acesso_sistema foi alterado para false
   - status foi alterado para inativo

3ï¸âƒ£ BUG NA LÃ“GICA DE VERIFICAÃ‡ÃƒO (10% probabilidade)
   - CondiÃ§Ã£o de verificaÃ§Ã£o com erro
   - Tipo de dados incompatÃ­vel
   - ComparaÃ§Ã£o falhando

ğŸ”§ PLANO DE AÃ‡ÃƒO RECOMENDADO:

PASSO 1 - LOGS DETALHADOS (IMEDIATO):
   âœ… Adicionar console.log apÃ³s query
   âœ… Logar dados recebidos
   âœ… Logar cada verificaÃ§Ã£o individual

PASSO 2 - VERIFICAR DADOS REAIS (URGENTE):
   âœ… Query direta no banco de dados
   âœ… Confirmar dados do Zeca Baleiro
   âœ… Verificar se houve alteraÃ§Ãµes

PASSO 3 - TESTAR RLS (IMPORTANTE):
   âœ… Verificar polÃ­ticas ativas
   âœ… Testar acesso com usuÃ¡rio atual
   âœ… Considerar ajuste de polÃ­ticas

PASSO 4 - BYPASS TEMPORÃRIO (SE NECESSÃRIO):
   âœ… Implementar funÃ§Ã£o RPC
   âœ… Testar funcionalidade
   âœ… Identificar soluÃ§Ã£o definitiva

ğŸ“‹ CÃ“DIGO SUGERIDO PARA DEBUG IMEDIATO:
   // Adicionar apÃ³s a query no PermissionsModal.tsx
   console.log('ğŸ” DEBUG ZECA:', { 
     employeeId, 
     data: usuarioEmpresa, 
     error: usuarioError 
   });

ğŸ¯ RESULTADO ESPERADO:
   Com logs detalhados, identificaremos exatamente
   onde a verificaÃ§Ã£o estÃ¡ falhando e poderemos
   aplicar a correÃ§Ã£o especÃ­fica necessÃ¡ria.

================================================================
ğŸš¨ AÃ‡ÃƒO NECESSÃRIA: IMPLEMENTAR LOGS DETALHADOS
================================================================`;

                showResult('final-diagnosis', resultado, 'error');
            }, 3000);
        }

        // InicializaÃ§Ã£o
        window.addEventListener('load', () => {
            console.log('ğŸ” Debug especÃ­fico do Zeca Baleiro carregado');
            console.log('ğŸ’¡ Execute o diagnÃ³stico para identificar o problema');
        });
    </script>
</body>
</html>